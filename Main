ORG	010
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
ADRESS_OF_FIRST_ELEMENT: WORD 602
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;VARIABLE:
SP1:	WORD	0000; STEK POINTER FOR PUSH
SP2:	WORD	0000; STEK POINTER FOR POP
SP3:	WORD	?
SP4:	WORD	?
COUNTER1:	WORD	?
COUNTER2:	WORD	?; SP3,SP4,COUNTER1,COUNTER2 - FOR BUBLE SORT
MIDLE:	WORD	?; MIDLE IN SORTED WINDOW ARRAY
MIDLE_2:	WORD	?; SECOND MIDLE IN EVEN ARRAY
SAVE_VALUE: WORD	?; FOR CHANGING TO ELEMENT
NEGATIVE_SIZE: WORD ?
LINK_TO_BUBLE: JSR BUBLE_SORT
BACK_TO_PROGRAM: BR	(WINDOW)
NEGATIVE_COUNT: WORD ?
BACK_TO_PROGRAM2: BR (PUSH_ARRAY_IN_STEK)
SP6: WORD 303
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
SP5: WORD ?
ADD_PLACE_FOR_WINDOW_ARRAY: CLA
MOV (SP5)
ISZ SP5
NOP
BR MOREPLACE
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
PUSH:	WORD	?
CLA
SUB	(PUSH)
MOV	PUSH_LENGTH
ISZ	PUSH
PUSH_LENGTH:	WORD	?
PUSHING:	CLA
ADD	SP1
DEC
MOV	SP1
CLA
ADD	(PUSH)
MOV	(SP1)
ISZ	PUSH
NOP
ISZ	PUSH_LENGTH
BR	PUSHING
BR	(PUSH)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
POP:	WORD	?
CLA
SUB	(POP)
MOV	POP_LENGTH
ISZ	POP
POP_LENGTH:	WORD	?
POPING:	CLA
ADD	(SP2)
MOV	(POP)
ISZ	POP
NOP
ISZ	SP2
NOP
ISZ	POP_LENGTH
BR	POPING
BR	(POP)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
POP2:	WORD	?
CLA
SUB	(POP2)
MOV	POP_LENGTH2
ISZ	POP2
POP_LENGTH2:	WORD	?
POPING2:	CLA
ADD	(SP2)
PRINT: TSF 1
BR PRINT
OUT 1
CLF 1
ISZ	POP2
NOP
ISZ	SP2
NOP
ISZ	POP_LENGTH2
BR	POPING2
BR STOP
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
INPUTING: 
CLA
CHECK_FLAG:	TSF	2
BR CHECK_FLAG
IN 2
CLF 2
MOV (SP6)
ISZ SP6
NOP
BR INPUT
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
BEGIN:	CLA
CHECK_FLAG2:	TSF	2
BR CHECK_FLAG2
IN 2
CLF 2
MOV SIZE
CLA
CHECK_FLAG3:	TSF	2
BR CHECK_FLAG3
IN 2
CLF 2
MOV COUNT
CLA
SUB COUNT
DEC
MOV NEGATIVE_COUNT
CLA
INPUT: ISZ NEGATIVE_COUNT
BR INPUTING
CLA
ADD BACK_TO_PROGRAM2
MOV (SP6)
CLA

ADD ADRESS_OF_FIRST_ELEMENT
MOV	SP5
MOV	SP3
INC
MOV SP4
CLA

SUB SIZE
DEC
MOV	NEGATIVE_SIZE
MOREPLACE: ISZ NEGATIVE_SIZE
BR ADD_PLACE_FOR_WINDOW_ARRAY
CLA
ADD LINK_TO_BUBLE
MOV (SP5)
ISZ SP5
NOP
CLA
ADD BACK_TO_PROGRAM
MOV (SP5)
JSR PUSH_ARRAY_IN_STEK
CLA
ADD	SP1
MOV	SP2
DEC
MOV	SP1
CLA
ADD	SP2
ADD	SIZE
DEC
MOV	SP2
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; START
START:	CLA
ADD	SP2
SUB	SIZE
INC
MOV SP2
JSR WINDOW; POP FROM STEK TO WINDOW ARRAY
JSR	PUSH; ADD RESULT TO FILTER ARRAY
WORD	0001
RESULT:	WORD	?
CLA
ADD	SP2
BEQ	END
NOT_END:	BR	START
END:	CLA
ADD SP1
MOV SP2
CLA
ADD COUNT
SUB SIZE
INC
MOV COUNT2
CLA
JSR POP2
COUNT2: WORD ?

ORG 150
STOP: HLT

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; BUBLE_SORT
ORG 200
BUBLE_SORT:	WORD	?
CLA
SUB	SIZE
INC
MOV	COUNTER2
LOOP:	CLA
ADD	COUNTER2
MOV	COUNTER1
SORT:	CLA
ADD (SP3)
SUB	(SP4)
BMI NEXT_STEP	
CLA
ADD (SP3)
MOV SAVE_VALUE
CLA
ADD	(SP4)
MOV (SP3)
CLA
ADD SAVE_VALUE
MOV (SP4)
CLA
NEXT_STEP:	ISZ SP3
NOP
ISZ SP4
NOP
ISZ	COUNTER1
BR	SORT
CLA
ADD	ADRESS_OF_FIRST_ELEMENT
MOV	SP3
INC
MOV SP4
CLA
ISZ	COUNTER2
BR	LOOP
CHOOSE_MIDLE:	CLA
ADD SIZE
ROR
BCS	NOT_EVEN
EVEN:	CLA
ADD	SIZE
ROR
ADD	ADRESS_OF_FIRST_ELEMENT
MOV	MIDLE
DEC
MOV	MIDLE_2
CLA
ADD	(MIDLE)
ADD	(MIDLE_2)
ROR
MOV	RESULT
BR	(BUBLE_SORT)
NOT_EVEN:	CLA
ADD	SIZE
ROR
ADD	ADRESS_OF_FIRST_ELEMENT
MOV	MIDLE
CLA
ADD	(MIDLE)
MOV	RESULT
BR	(BUBLE_SORT)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
ORG 300
PUSH_ARRAY_IN_STEK: WORD ?
JSR	PUSH
COUNT:	WORD	?;  NUMBER OF ARRAY ELEMENTS;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
ORG	5FF
WINDOW:	WORD	?
JSR	POP
SIZE:	WORD	?
